# 第53课：单调栈（下）

## 一、单调栈进阶用法概述

### （一）定义

除了单调栈最经典的用法（寻找最近的较小值或较大值），单调栈还可以用于维持求解答案的可能性。具体来说：

1. **单调性组织**：单调栈里的所有对象按照规定好的单调性来组织。
2. **淘汰无用对象**：当某个对象进入单调栈时，会从栈顶开始依次淘汰单调栈里对后续求解答案没有帮助的对象。
3. **结算答案**：每个对象从栈顶弹出时结算当前对象参与的答案，随后这个对象不再参与后续求解答案的过程。
4. **基于题目分析**：这种用法是基于对题目的深入分析，发现其中的单调性，然后利用单调栈的特征去实现。

### （二）注意事项

- 单调栈可以和很多技巧交叉使用，例如动态规划+单调栈优化，这将在后续课程中介绍。

## 二、单调栈进阶用法的应用

### （一）最大宽度坡

- **问题描述**：给定一个整数数组`A`，坡是元组`(i, j)`，其中`i < j`且`A[i] <= A[j]`。这样的坡的宽度为`j - i`，找出`A`中的坡的最大宽度，如果不存在，返回0。
- **解题思路**：
  1. 使用单调递减栈，从左到右遍历数组。
  2. 对于每个元素，如果当前元素大于栈顶元素，说明找到了一个可能的坡，计算宽度并更新最大宽度。
  3. 如果当前元素小于或等于栈顶元素，将当前元素的索引入栈。
- **测试链接**：[LeetCode - Maximum Width Ramp](https://leetcode.cn/problems/maximum-width-ramp/)

### （二）去除重复字母保证剩余字符串的字典序最小

- **问题描述**：给定一个字符串`s`，去除字符串中重复的字母，使得每个字母只出现一次，需保证返回结果的字典序最小，要求不能打乱其他字符的相对位置。
- **解题思路**：
  1. 使用单调栈，从左到右遍历字符串。
  2. 对于每个字符，如果当前字符小于栈顶字符且栈顶字符在后续还会出现，则弹出栈顶字符。
  3. 将当前字符压入栈，最终栈中的字符即为结果。
- **测试链接**：[LeetCode - Remove Duplicate Letters](https://leetcode.cn/problems/remove-duplicate-letters/)

### （三）大鱼吃小鱼问题

- **问题描述**：给定一个数组`arr`，每个值代表鱼的体重。每一轮，每条鱼都会吃掉右边离自己最近比自己体重小的鱼，每条鱼向右找只吃一条。如果有多条鱼在当前轮找到的是同一条小鱼，那么在这一轮，这条小鱼同时被这些大鱼吃。返回多少轮后，鱼的数量就固定了。
- **解题思路**：
  1. 使用单调栈，从左到右遍历数组。
  2. 对于每条鱼，如果当前鱼的体重大于栈顶鱼的体重，说明当前鱼可以吃掉栈顶鱼，弹出栈顶鱼并计数。
  3. 将当前鱼压入栈，重复上述过程直到遍历完数组。
- **测试链接**：[牛客网 - 大鱼吃小鱼问题](https://www.nowcoder.com/practice/77199defc4b74b24b8ebf6244e1793de)

### （四）统计全1子矩形的数量

- **问题描述**：给定一个`m * n`的矩阵`mat`，其中只有0和1两种值，返回有多少个子矩形的元素全部都是1。
- **解题思路**：
  1. 将二维矩阵转换为多个一维柱状图，每个一维柱状图表示矩阵中某一行及其上方行的连续1的高度。
  2. 对每个一维柱状图，使用单调栈求解全1子矩形的数量。
  3. 遍历所有一维柱状图，累加全1子矩形的数量。
- **测试链接**：[LeetCode - Count Submatrices With All Ones](https://leetcode.cn/problems/count-submatrices-with-all-ones/)
- **注意**：需要先理解“柱状图中最大的矩形”和“全是1的最大矩形”问题。

## 三、总结

单调栈不仅在经典问题（如寻找最近的较小值或较大值）中表现出色，还可以用于更复杂的问题，通过维持求解答案的可能性来优化算法。掌握单调栈的关键在于理解其进阶用法，并能够灵活应用于各种问题。单调栈还可以与其他算法技巧结合使用，如动态规划，以解决更复杂的问题。