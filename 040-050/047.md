# 第47课：一维差分与等差数列差分

#### 前置知识

- 了解数组的基本概念即可。

#### 一维差分

- **特点**：非常简单，没有理解难度。但不支持边操作、边查询。
- **应用场景**：适用于一些简单的区间更新问题。

#### 等差数列差分

- **问题描述**：初始时1~n范围上的数字都是0，接下来有m个操作。每次操作是在l~r范围上依次加上首项为s、末项为e、公差为d的等差数列，最终需要得到1~n范围上每个数字的正确值。

- **操作过程**：

  - 每个操作通过调用`set`方法实现。
  - 所有操作完成后，在`arr`上生成两遍前缀和，即调用`build`方法，最终`arr`里存储的就是1~n范围上每个数字的值。

- **代码实现**：

  ```cpp
  void set(int l, int r, int s, int e, int d) {
      arr[l] += s;
      arr[l + 1] += d - s;
      arr[r + 1] -= d + e;
      arr[r + 2] += e;
  }
  
  void build() {
      for (int i = 1; i <= n; i++) {
          arr[i] += arr[i - 1];
      }
      for (int i = 1; i <= n; i++) {
          arr[i] += arr[i - 1];
      }
  }
  ```

- **注意事项**：

  - 等差数列差分在大厂笔试、面试中还不常见，但在比赛里是必备技巧，预计未来会流行。
  - 二维差分会在后续课程中进一步讲述，支持边操作、边查询的结构会在扩展课程中讲解。

#### 练习题目

##### 题目1：航班预订统计

- **问题描述**：有n个航班，编号从1到n。有一份航班预订表`bookings`，表中第i条预订记录`bookings[i] = [firsti, lasti, seatsi]`表示从`firsti`到`lasti`（包含`firsti`和`lasti`）的每个航班上预订了`seatsi`个座位。要求返回一个长度为n的数组`answer`，其中的元素是每个航班预定的座位总数。
- **解题思路**：可以使用一维差分的思想来解决。初始化一个长度为n的数组`answer`，遍历`bookings`，对于每条预订记录，更新`answer`数组，最后返回`answer`即可。

##### 题目2：等差数列差分模版

- **问题描述**：初始时1~n范围上的数字都是0，一共有m个操作，每次操作为(l,r,s,e,d)，表示在l~r范围上依次加上首项为s、末项为e、公差为d的等差数列。m个操作做完之后，统计1~n范围上所有数字的最大值和异或和。
- **数据范围**：
  - 1 <= n <= 10^7
  - 1 <= m <= 3 * 10^5
  - 1 <= l <= r <= n
- **解题思路**：直接应用等差数列差分的模板，通过`set`方法完成所有操作，然后调用`build`方法计算最终结果，最后遍历结果数组求最大值和异或和。

##### 题目3：等差数列差分经典题目

- **问题描述**：一群人落水后求每个位置的水位高度，问题描述比较复杂，具体见测试链接：https://www.luogu.com.cn/problem/P5026。
- **解题思路**：注意题目中OFFSET的设计，可以避免大量的边界讨论，利用等差数列差分的方法来求解每个位置的水位高度。

#### 总结

- 一维差分和等差数列差分是解决区间更新问题的常用技巧，虽然等差数列差分在实际应用中还不太常见，但掌握它对于参加算法竞赛很有帮助。
- 在学习过程中，可以通过练习题目来加深对这些算法的理解和应用能力。