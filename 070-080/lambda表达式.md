lambda表达式

### **1. 基本语法结构**

```cpp
[捕获列表] (参数列表) -> 返回类型 { 函数体 }
```
- **捕获列表 (Capture Clause)**：定义lambda如何访问外部变量。
- **参数列表 (Parameters)**：与普通函数的参数列表类似，可选。
- **返回类型 (Return Type)**：可省略，由编译器自动推导。
- **函数体 (Body)**：实现逻辑的代码块。

---

### **2. 捕获列表详解**
捕获列表决定了lambda如何访问其外部作用域的变量：
- **值捕获** `[x]`：捕获变量`x`的副本，不可修改（除非用`mutable`）。
- **引用捕获** `[&x]`：捕获变量`x`的引用，可修改原值。
- **隐式捕获**：
  - `[=]`：以值捕获所有外部变量。
  - `[&]`：以引用捕获所有外部变量。
- **混合捕获**：
  - `[=, &x]`：默认值捕获，但`x`以引用捕获。
  - `[&, x]`：默认引用捕获，但`x`以值捕获。
- **特殊捕获**：
  - `[this]`：捕获当前类的`this`指针，用于访问成员变量。
  - `[*this]`（C++17）：按值捕获当前对象副本。

---

### **3. 参数列表与返回类型**
- **参数列表**：
  - 可以省略（如`[] { return 42; }`）。
  - 支持`auto`参数（C++14起），实现泛型lambda：
    ```cpp
    auto add = [](auto a, auto b) { return a + b; };
    ```
- **返回类型**：
  - 通常可自动推导，但复杂逻辑需显式指定：
    ```cpp
    [](int x) -> double { 
        if (x > 0) return 1.0; 
        else return 0.0; 
    };
    ```

---

### **4. mutable 关键字**
允许修改按值捕获的变量（默认情况下，值捕获的变量是`const`）：
```cpp
int x = 0;
auto lambda = [x]() mutable { x++; }; // 修改的是副本
lambda(); // x 仍为 0
```

---

### **5. 示例代码**
#### **简单示例**
```cpp
// 无参lambda
auto greet = [] { std::cout << "Hello!"; };
greet(); // 输出 Hello!

// 带参数和返回类型
auto sum = [](int a, int b) { return a + b; };
std::cout << sum(3, 4); // 输出 7
```

#### **捕获变量**
```cpp
int x = 10, y = 20;
// 值捕获x，引用捕获y
auto lambda = [x, &y]() { y += x; };
lambda(); // y 变为 30
```

#### **在STL算法中的应用**
```cpp
std::vector<int> nums = {3, 1, 4, 1, 5};
// 按绝对值排序
std::sort(nums.begin(), nums.end(), [](int a, int b) {
    return abs(a) < abs(b);
});
```

---

### **6. 注意事项**
- **悬垂引用**：避免捕获局部变量的引用（如函数返回一个lambda，其内部引用了栈上的变量）。
- **性能**：按值捕获大对象可能影响性能，优先考虑引用捕获或按需捕获。
- **C++14+ 增强**：
  - 泛型lambda（`auto`参数）。
  - 捕获表达式（C++14起，如`[x = y + 1]`）。
  - 模板lambda（C++20起，支持模板参数列表）。

---

### **7. 底层机制**
Lambda表达式会被编译器转换为一个匿名类的实例，该类重载了`operator()`。例如：
```cpp
// lambda: [](int x) { return x * 2; }
// 编译器生成的类类似：
class __AnonymousLambda {
public:
    int operator()(int x) const { return x * 2; }
};
```

---

通过灵活组合捕获方式、参数和返回类型，lambda能够优雅地替代传统函数对象，提升代码可读性和编写效率。