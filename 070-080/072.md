# 第72课：最长递增子序列问题与扩展

## 一、前置知识
- **二分搜索**：熟悉二分搜索的基本原理和实现方法，它在后续解决最长递增子序列问题的优化算法中起到关键作用。
- **一维动态规划**：掌握一维动态规划的思想和解题步骤，因为最长递增子序列问题的经典解法是基于动态规划的。

## 二、最长递增子序列（LIS）问题
### 问题描述
给定一个整数数组`nums`，找到其中最长严格递增子序列的长度以及最长不下降子序列的长度。

### 解法
- **动态规划解法**
  - 定义`dp[i]`表示以`nums[i]`结尾的最长递增子序列的长度。
  - 状态转移方程：`dp[i] = max(dp[j] + 1)`，其中`0 <= j < i`且`nums[j] < nums[i]`。
  - 时间复杂度为O(n^2)，空间复杂度为O(n)。
- **优化解法（本课重点）**
  - 使用一个辅助数组`tails`，其中`tails[i]`表示长度为`i + 1`的所有递增子序列中结尾元素的最小值。
  - 遍历数组`nums`，对于每个元素`num`，使用二分搜索在`tails`中找到第一个大于等于`num`的位置`pos`，并更新`tails[pos] = num`。
  - 最终`tails`的长度即为最长递增子序列的长度。
  - 时间复杂度为O(n * logn)，空间复杂度为O(n)。

### 注意事项
- 最长不下降子序列只需改写二分策略即可，具体来说，在二分搜索时，找到第一个大于等于`num`的位置`pos`，更新`tails[pos] = num`。

## 三、俄罗斯套娃信封问题
### 问题描述
给定一个二维整数数组`envelopes`，其中`envelopes[i] = [wi, hi]`表示第`i`个信封的宽度和高度。当另一个信封的宽度和高度都比这个信封大时，这个信封就可以放进另一个信封里。计算最多能有多少个信封能组成一组“俄罗斯套娃”信封，不允许旋转信封。

### 解法
- 首先对信封数组按照宽度升序、高度降序进行排序。
- 然后将问题转化为最长递增子序列问题，即在排序后的信封数组中，找到高度数组的最长递增子序列长度。
- 使用优化的最长递增子序列解法，时间复杂度为O(n * logn)，空间复杂度为O(n)。

## 四、使数组K递增的最少操作次数
### 问题描述
给定一个下标从0开始包含n个正整数的数组`arr`和一个正整数`k`。如果对于每个满足`k <= i <= n - 1`的下标`i`，都有`arr[i - k] <= arr[i]`，那么称`arr`是K递增的。每次操作可以选择一个下标`i`并将`arr[i]`改成任意正整数，返回使数组变成K递增的最少操作次数。

### 解法
- 对于每个下标`i`，如果`arr[i - k] > arr[i]`，则需要进行一次操作，将`arr[i]`修改为`arr[i - k]`。
- 使用动态规划的思想，定义`dp[i]`表示使数组从下标`0`到`i`满足K递增条件的最少操作次数。
- 状态转移方程：`dp[i] = dp[i - 1] + (arr[i - k] > arr[i] ? 1 : 0)`。
- 最终答案为`dp[n - 1]`。
- 时间复杂度为O(n)，空间复杂度为O(n)。

## 五、最长数对链
### 问题描述
给定一个由n个数对组成的数对数组`pairs`，其中`pairs[i] = [lefti, righti]`且`lefti < righti`。定义一种“跟随”关系，当且仅当`b < c`时，数对`p2 = [c, d]`才可以跟在`p1 = [a, b]`后面。构造数对链，找出并返回能够形成的最长数对链的长度。

### 解法
- 首先对数对数组按照右端点升序排序。
- 然后使用动态规划的思想，定义`dp[i]`表示以`pairs[i]`结尾的最长数对链的长度。
- 状态转移方程：`dp[i] = max(dp[j] + 1)`，其中`0 <= j < i`且`pairs[j][1] < pairs[i][0]`。
- 最终答案为`max(dp)`。
- 时间复杂度为O(n^2)，空间复杂度为O(n)。

## 六、有一次修改机会的最长不下降子序列
### 问题描述
给定一个长度为n的数组`arr`和一个整数`k`，只有一次机会可以将其中连续的`k`个数全修改成任意一个值，这次机会可以用也可以不用，返回最长不下降子序列长度。

### 解法
- 这是一个较为复杂的问题，需要综合考虑动态规划和贪心算法的思想。
- 首先计算出不使用修改机会时的最长不下降子序列长度。
- 然后遍历数组，对于每个可能的修改区间，计算出使用修改机会后的最长不下降子序列长度。
- 最终答案为不使用修改机会时的最长不下降子序列长度与使用修改机会后的最长不下降子序列长度中的最大值。
- 时间复杂度为O(n^2)，空间复杂度为O(n)。

## 七、预告
- **最长递增子序列的数量问题**：给定一个未排序的整数数组`nums`，返回最长递增子序列的个数。这个问题的最优解能做到O(n * logn)，会在后续的【扩展】课程阶段，详解树状数组（index tree）的时候来讲解。

## 八、总结
- 本节课主要讲解了最长递增子序列及其相关问题的解法，重点在于掌握优化的最长递增子序列解法，即利用二分搜索和辅助数组`tails`来降低时间复杂度。
- 通过这些题目的学习，可以深入理解动态规划、二分搜索、贪心算法等算法思想在解决实际问题中的应用。
- 在学习过程中，需要注意理解每个问题的解题思路和状态转移方程，以及如何将复杂问题转化为已知的简单问题来求解。
