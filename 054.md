# 第54课：单调队列（上）

## 一、单调队列概述

### （一）定义

单调队列是一种特殊的队列结构，队列内的元素始终保持单调递增或单调递减的顺序。它主要用于解决滑动窗口相关的问题，能够在滑动窗口的过程中高效地维护窗口内的最大值或最小值。

### （二）经典用法

单调队列最经典的用法是解决滑动窗口问题，具体如下：

1. **滑动窗口的定义**：滑动窗口在滑动时，`r++`代表右侧数字进窗口，`l++`代表左侧数字出窗口。
2. **目标**：在滑动窗口的过程中，随时得到当前窗口的最大值或最小值。
3. **效率优势**：窗口滑动的过程中，单调队列所有调整的总代价为O(n)，单次操作的均摊代价为O(1)。

### （三）注意事项

- 单调队列可以和很多技巧交叉使用，例如动态规划+单调队列优化，这将在后续课程中介绍。

## 二、单调队列的实现

### （一）单调递增队列

- **维护单调递增**：队列内的元素始终保持单调递增。
- **进窗口操作**：当新元素进入窗口时，从队尾开始，弹出所有比新元素大的元素，然后将新元素加入队尾。
- **出窗口操作**：当元素出窗口时，检查队首元素是否是出窗口的元素，如果是，则弹出队首元素。

### （二）单调递减队列

- **维护单调递减**：队列内的元素始终保持单调递减。
- **进窗口操作**：当新元素进入窗口时，从队尾开始，弹出所有比新元素小的元素，然后将新元素加入队尾。
- **出窗口操作**：当元素出窗口时，检查队首元素是否是出窗口的元素，如果是，则弹出队首元素。

## 三、单调队列的应用

### （一）滑动窗口最大值（单调队列经典用法模板）

- **问题描述**：给定一个整数数组`nums`，有一个大小为`k`的滑动窗口从数组的最左侧移动到数组的最右侧。滑动窗口每次只向右移动一位，返回滑动窗口中的最大值。
- **解题思路**：
  1. 使用单调递减队列，维护窗口内的最大值。
  2. 遍历数组，对于每个元素：
     - 从队尾开始，弹出所有比当前元素小的元素。
     - 将当前元素的索引入队。
     - 如果队首元素的索引小于等于`l`，弹出队首元素。
     - 当窗口大小达到`k`时，队首元素即为当前窗口的最大值。
- **测试链接**：[LeetCode - Sliding Window Maximum](https://leetcode.cn/problems/sliding-window-maximum/)

### （二）绝对差不超过限制的最长连续子数组

- **问题描述**：给定一个整数数组`nums`和一个表示限制的整数`limit`，返回最长连续子数组的长度，该子数组中的任意两个元素之间的绝对差必须小于或等于`limit`。如果不存在满足条件的子数组，则返回0。
- **解题思路**：
  1. 使用两个单调队列，一个维护最大值，一个维护最小值。
  2. 遍历数组，对于每个元素：
     - 将当前元素加入两个队列。
     - 如果最大值和最小值的差超过`limit`，移动左边界，直到差值小于或等于`limit`。
     - 更新最长子数组的长度。
- **测试链接**：[LeetCode - Longest Continuous Subarray With Absolute Diff Less Than or Equal to Limit](https://leetcode.cn/problems/longest-continuous-subarray-with-absolute-diff-less-than-or-equal-to-limit/)

### （三）接取落水的最小花盆

- **问题描述**：给出`N`滴水的坐标，`y`表示水滴的高度，`x`表示它下落到`x`轴的位置。每滴水以每秒1个单位长度的速度下落。需要把花盆放在`x`轴上的某个位置，使得从被花盆接着的第一滴水开始，到被花盆接着的最后一滴水结束，之间的时间差至少为`D`。求最小的花盆的宽度`W`。
- **解题思路**：
  1. 按照水滴的下落时间排序。
  2. 使用单调队列，维护当前花盆能接住的水滴的范围。
  3. 遍历水滴，对于每个水滴：
     - 将当前水滴加入队列。
     - 如果队列中最早下落的水滴和当前水滴的时间差大于`D`，移动左边界，直到时间差小于或等于`D`。
     - 更新最小花盆的宽度。
- **测试链接**：[洛谷 - 接取落水的最小花盆](https://www.luogu.com.cn/problem/P2698)

## 四、总结

单调队列是一种非常高效的算法技巧，特别适用于解决滑动窗口相关的问题。通过维护一个单调递增或单调递减的队列，可以在O(n)的时间复杂度内完成许多复杂的查询。掌握单调队列的关键在于理解其经典用法，并能够灵活应用于各种问题。单调队列还可以与其他算法技巧结合使用，如动态规划，以解决更复杂的问题。