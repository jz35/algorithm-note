# 第55课：单调队列（下）

### 单调队列算法学习笔记

单调队列是一种特殊的队列，它能够高效地维护一个单调递增或单调递减的序列。单调队列在处理滑动窗口问题、最值问题等场景中非常有效。以下是单调队列的原理和应用的详细讲解。

## 一、单调队列的基本概念

单调队列是一种特殊的队列，它满足以下两个条件：

1. **单调性**：队列中的元素按照某种单调性（递增或递减）排列。
2. **双端操作**：支持从队头和队尾进行元素的插入和删除操作。

单调队列的核心操作包括：

1. **插入操作**：当新元素加入队列时，从队尾开始，依次移除那些不会对后续求解答案产生帮助的元素。
2. **删除操作**：当需要从队列中移除元素时，可以从队头或队尾进行操作。
3. **查询操作**：队头或队尾的元素通常是最值（最大值或最小值）。

## 二、单调队列的实现原理

单调队列的实现基于双端队列（deque），支持从队头和队尾进行操作。以下是单调队列的实现步骤：

1. **插入操作**：
   - 当新元素加入队列时，从队尾开始，依次移除那些不会对后续求解答案产生帮助的元素。
   - 具体来说，如果新元素比队尾元素更优（例如，更小或更大），则移除队尾元素，直到队尾元素比新元素更优或队列为空。
   - 将新元素插入队尾。
2. **删除操作**：
   - 当需要从队列中移除元素时，可以从队头或队尾进行操作。
   - 例如，在滑动窗口问题中，当窗口滑动时，需要从队头移除那些不再属于当前窗口的元素。
3. **查询操作**：
   - 队头或队尾的元素通常是最值（最大值或最小值）。
   - 例如，在求滑动窗口的最大值或最小值时，队头或队尾的元素即为所求。

## 三、单调队列的应用场景

单调队列适用于以下类型的问题：

1. **滑动窗口问题**：求滑动窗口的最大值或最小值。
2. **最值问题**：在动态序列中求最值。
3. **优化问题**：结合动态规划等算法，优化求解过程。

## 四、单调队列的具体应用实例

### 1. **题目1：和至少为K的最短子数组**

题目链接：https://leetcode.cn/problems/shortest-subarray-with-sum-at-least-k/

**问题描述**：给定一个数组 arr，其中的值可以是正数、负数或0。给定一个正数 k，返回累加和至少为 k 的所有子数组中，最短的子数组长度。

**解题思路**：

1. **构建前缀和数组**：计算数组的前缀和数组 prefixSum，其中 prefixSum[i] 表示从数组开头到第 i 个元素的累加和。
2. **使用单调队列**：维护一个单调递增的队列，队列中的元素为前缀和数组的索引。
   - 当新元素加入队列时，从队尾开始，依次移除那些不会对后续求解答案产生帮助的元素。
   - 具体来说，如果新元素的前缀和减去队头元素的前缀和大于等于 k，则更新最短子数组长度，并从队头移除该元素。
3. **更新答案**：每次从队头移除元素时，更新最短子数组长度。

### 2. **题目2：满足不等式的最大值**

题目链接：https://leetcode.cn/problems/max-value-of-equation/

**问题描述**：给定一个数组 points 和一个整数 k，数组中每个元素都表示二维平面上的点的坐标，并按照横坐标 x 的值从小到大排序。请你找出 yi+yj+∣xi−xj∣ 的最大值，其中 ∣xi−xj∣≤k 且 1≤i<j≤points.length。

**解题思路**：

1. **构建单调队列**：维护一个单调递减的队列，队列中的元素为点的索引。
   - 当新元素加入队列时，从队尾开始，依次移除那些不会对后续求解答案产生帮助的元素。
   - 具体来说，如果新元素的 y 值加上 x 值减去队头元素的 y 值减去 x 值大于当前最大值，则更新最大值，并从队头移除该元素。
2. **更新答案**：每次从队头移除元素时，更新最大值。

### 3. **题目3：你可以安排的最多任务数目**

题目链接：https://leetcode.cn/problems/maximum-number-of-tasks-you-can-assign/

**问题描述**：给定 n 个任务和 m 个工人，每个任务需要一定的力量值才能完成，每个工人的力量值保存在数组 workers 中。每个工人只能完成一个任务，且力量值需要大于等于该任务的力量要求值。此外，你还有 pills 个神奇药丸，可以给一个工人的力量值增加 strength。你可以决定给哪些工人使用药丸，但每个工人最多只能使用一片药丸。返回最多可以完成的任务数目。

**解题思路**：

1. **二分答案法**：使用二分答案法确定最多可以完成的任务数目。
2. **单调队列优化**：在二分答案的过程中，使用单调队列优化任务分配的判断过程。
   - 维护一个单调递增的队列，队列中的元素为任务的索引。
   - 当新任务加入队列时，从队尾开始，依次移除那些不会对后续求解答案产生帮助的元素。
3. **更新答案**：每次从队头移除元素时，更新最多可以完成的任务数目。

## 五、单调队列的优势

单调队列的优势在于其高效性和灵活性：

1. **高效性**：单调队列的时间复杂度为 O(n)，适用于大规模数据。
2. **灵活性**：可以动态处理序列的插入和删除操作。
3. **易实现**：代码实现简单，适合快速解决实际问题。

通过以上分析，可以看出单调队列是一种非常强大且实用的数据结构，广泛应用于各类算法和实际问题中。