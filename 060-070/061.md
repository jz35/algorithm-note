# 第61课：最小生成树

## 一、最小生成树概述

**定义**：在无向带权图中选择一些边，在保证连通性的情况下，边的总权值最小。

**特点**：

- 最小生成树可能不只一棵，只要边的总权值最小，就都是正确的。
- 若图有 n 个点，则最小生成树有 n - 1 条边。
- 最小生成树一定是最小瓶颈树。

## 二、Kruskal 算法

**步骤**：

1. 把所有边按权值从小到大排序。
2. 从权值小的边开始考虑，若连接当前边不会形成环，则选择该边；否则舍弃。
3. 考察完所有边后，得到最小生成树。

**时间复杂度**：O(m * log m) + O(n) + O(m)，其中 m 为边数，n 为点数。

**适用场景**：边数较少的稀疏图。

**测试链接**：[P3366](https://www.luogu.com.cn/problem/P3366)

## 三、Prim 算法

**普通版**：

1. 初始化：解锁的点集合 set 和解锁的边集合 heap（小根堆）均为空。
2. 从任意点开始，将其加入 set，该点所有边加入 heap。
3. 从 heap 中弹出权值最小的边 e，查看边 e 所去往的点 x。
   - 若 x 已在 set 中，舍弃边 e，重复步骤 3。
   - 若 x 不在 set 中，边 e 属于最小生成树，将 x 加入 set，重复步骤 3。
4. 当 heap 为空时，得到最小生成树。

**时间复杂度**：O(n + m) + O(m * log m)

**优化版**：

1. 小根堆里放 (节点，到达节点的花费)，按到达节点的花费组织小根堆。
2. 弹出 (u 节点，到达 u 节点的花费 y)，将 y 累加到总权重，考察 u 出发的每条边。
   - 若边去往的 v 节点已弹出过，忽略该边。
   - 若 v 从未进入过堆，向堆里加入记录 (v, w)。
   - 若 v 在堆里，记录为 (v, x)：
     - 若 w < x，更新记录为 (v, w)，调整堆。
     - 若 w >= x，忽略该边。
3. 重复步骤 2，直到堆为空。

**时间复杂度**：O(n + m) + O((m + n) * log n)

**适用场景**：边数较多的稠密图。

**测试链接**：[P3366](https://www.luogu.com.cn/problem/P3366)

## 四、最小生成树的应用

### （一）水资源分配优化

**问题描述**：村内有 n 栋房子，可通过建造水井或铺设管道供水。给定每栋房子建造水井的成本和房子间铺设管道的成本，求最低总成本。

**解题思路**：将每栋房子看作图的节点，建造水井的成本视为自环边，铺设管道的成本视为边权，利用最小生成树算法求解。

**测试链接**：[Optimize Water Distribution in a Village](https://leetcode.cn/problems/optimize-water-distribution-in-a-village/)

### （二）检查边长度限制的路径是否存在

**问题描述**：给定无向图边集和查询数组，判断每个查询中是否存在从起点到终点的路径，且路径上每条边都严格小于给定限制。

**解题思路**：对边按长度排序，按查询限制从小到大依次处理，利用并查集动态维护连通性，判断路径是否存在。

**测试链接**：[Checking Existence of Edge Length Limited Paths](https://leetcode.cn/problems/checking-existence-of-edge-length-limited-paths/)

### （三）繁忙的都市

**问题描述**：城市中有 n 个交叉路口和一些道路，每条道路有分值。市长希望改造尽量少的道路，且分值最大的道路分值尽量小，同时保证所有交叉路口连通。

**解题思路**：利用最小生成树算法，选择分值最小的边构成生成树，满足改造道路少且分值最大道路分值小的要求。

**测试链接**：[P2330](https://www.luogu.com.cn/problem/P2330)

