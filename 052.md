# 第52课：单调栈（上）

## 一、单调栈概述

### （一）定义

单调栈是一种特殊的栈结构，==栈内的元素始终保持单调递增或单调递减的顺序==。它主要用于解决与数组或序列相关的特定问题，如==寻找某个位置左侧或右侧第一个比该位置元素大或小的位置==。

### （二）经典用法

单调栈最经典的用法是解决以下两类问题：

1. **寻找最近的较小值或较大值**：
   - 对于每个位置，找到其左侧比当前位置数字小（或大）且距离最近的位置。
   - 对于每个位置，找到其右侧比当前位置数字小（或大）且距离最近的位置。
2. **效率优势**：通过单调栈，可以在总代价为O(n)的时间复杂度内完成上述查询，单次操作的均摊代价为O(1)。

### （三）注意事项

- 单调栈可以和很多技巧交叉使用，例如动态规划+单调栈优化，这将在后续课程中介绍。
- 单调栈的处理方式在数组有重复值和无重复值时有所不同，需要特别注意。

## 二、单调栈的实现

### （一）数组无重复值的情况

1. **单调递增栈**：栈内元素始终保持单调递增。
   - 当前元素大于栈顶元素时，将当前元素压入栈。
   - 当前元素小于栈顶元素时，弹出栈顶元素，直到栈为空或当前元素大于栈顶元素。
2. **单调递减栈**：栈内元素始终保持单调递减。
   - 当前元素小于栈顶元素时，将当前元素压入栈。
   - 当前元素大于栈顶元素时，弹出栈顶元素，直到栈为空或当前元素小于栈顶元素。

### （二）数组有重复值的情况

- 在处理重复值时，需要根据具体问题决定是否允许重复值入栈。通常情况下，允许重复值入栈可以简化逻辑，但在某些问题中可能需要特殊处理。

## 三、单调栈的应用

### （一）单调栈最经典用法的模板

- **问题描述**：给定一个数组，对于每个位置，找到其左侧和右侧第一个比该位置元素小（或大）的位置。
- **解题思路**：
  1. 使用单调栈，从左到右遍历数组，找到每个位置左侧第一个比该位置元素小的位置。
  2. 使用单调栈，从右到左遍历数组，找到每个位置右侧第一个比该位置元素小的位置。
- **测试链接**：[牛客网 - 单调栈模板](https://www.nowcoder.com/practice/2a2c00e7a88a498693568cef63a4b7bb)

### （二）每日温度

- **问题描述**：给定一个整数数组`temperatures`，表示每天的温度，返回一个数组`answer`，其中`answer[i]`是指对于第`i`天，下一个更高温度出现在几天后。如果气温在这之后都不会升高，请在该位置用0来代替。
- **解题思路**：
  1. 使用单调递减栈，从左到右遍历数组。
  2. 对于每个温度，如果当前温度大于栈顶温度，说明找到了一个更高的温度，计算天数差并更新`answer`。
  3. 如果当前温度小于或等于栈顶温度，将当前温度的索引入栈。
- **测试链接**：[LeetCode - Daily Temperatures](https://leetcode.cn/problems/daily-temperatures/)

### （三）子数组的最小值之和

- **问题描述**：给定一个整数数组`arr`，找到`min(b)`的总和，其中`b`的范围为`arr`的每个（连续）子数组。由于答案可能很大，返回答案模`10^9 + 7`。
- **解题思路**：
  1. 使用单调递增栈，从左到右遍历数组，找到每个位置左侧第一个比该位置元素小的位置。
  2. 使用单调递增栈，从右到左遍历数组，找到每个位置右侧第一个比该位置元素小的位置。
  3. 对于每个位置，计算以该位置为最小值的子数组数量，并累加到总和中。
- **测试链接**：[LeetCode - Sum of Subarray Minimums](https://leetcode.cn/problems/sum-of-subarray-minimums/)
- **注意**：答案可能很大，需要取模。

### （四）柱状图中最大的矩形

- **问题描述**：给定`n`个非负整数，用来表示柱状图中各个柱子的高度。每个柱子彼此相邻，且宽度为1。求在该柱状图中，能够勾勒出来的矩形的最大面积。
- **解题思路**：
  1. 使用单调递增栈，从左到右遍历数组。
  2. 对于每个柱子，如果当前柱子的高度小于栈顶柱子的高度，说明找到了一个可以计算矩形面积的机会。
  3. 弹出栈顶柱子，计算以该柱子为高度的矩形面积，并更新最大面积。
  4. 将当前柱子的索引入栈。
- **测试链接**：[LeetCode - Largest Rectangle in Histogram](https://leetcode.cn/problems/largest-rectangle-in-histogram)

### （五）最大矩形

- **问题描述**：给定一个仅包含0和1、大小为`rows * cols`的二维二进制矩阵，找出只包含1的最大矩形，并返回其面积。
- **解题思路**：
  1. 将二维矩阵转换为多个一维柱状图，每个一维柱状图表示矩阵中某一行及其上方行的连续1的高度。
  2. 对每个一维柱状图，使用单调栈求解最大矩形面积。
  3. 遍历所有一维柱状图，找到最大矩形面积。
- **测试链接**：[LeetCode - Maximal Rectangle](https://leetcode.cn/problems/maximal-rectangle/)

## 四、总结

单调栈是一种非常高效的算法技巧，特别适用于解决与数组或序列相关的特定问题。通过维护一个单调递增或单调递减的栈，可以在O(n)的时间复杂度内完成许多复杂的查询。掌握单调栈的关键在于理解其经典用法，并能够灵活应用于各种问题。单调栈还可以与其他算法技巧结合使用，如动态规划，以解决更复杂的问题。