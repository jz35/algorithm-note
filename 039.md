# 第39课：嵌套类问题递归解题套路

## 一、前置知识

在学习嵌套类问题的递归解题套路之前，需要先熟悉讲解017、020、021、023、036、037、038这些章节中对递归的分析，尤其是讲解038，不熟悉的同学可以先重点复习。

## 二、嵌套类问题的递归解题套路

### （一）大概过程

1. **定义全局变量**：定义一个全局变量`int where`，用于记录解析的位置。
2. **递归函数定义**：设计递归函数`f(i)`，其作用是从字符串`s`的第`i`个位置开始解析，直到遇到字符串终止或嵌套条件终止时返回。
3. **返回值**：`f(i)`的返回值是其负责解析的这一段的结果。
4. **更新全局变量**：在`f(i)`返回前，需要更新全局变量`where`，以便上级函数通过`where`知道解析到了什么位置，从而能够继续解析后续内容。

### （二）执行细节

1. **处理嵌套条件**：如果`f(i)`在解析过程中遇到嵌套条件开始，就调用下级递归函数去处理嵌套部分。下级递归函数会负责计算嵌套部分的结果。
2. **根据全局变量继续解析**：当下级递归处理完成后，`f(i)`可以根据下级递归更新的全局变量`where`，确定从什么位置继续解析后续内容。

## 三、实战题目

1. **含有嵌套的表达式求值**：该题目要求对含有嵌套的表达式进行求值，时间复杂度为O(n)。在解决此题时，可以运用上述递归解题套路，通过递归函数逐层解析表达式中的嵌套部分，并利用全局变量记录解析位置，最终得到整个表达式的求值结果。
2. **含有嵌套的字符串解码**：此题要求对含有嵌套的字符串进行解码，时间复杂度同样为O(n)。解题思路与表达式求值类似，通过递归函数处理字符串中的嵌套编码部分，根据全局变量确定解码的顺序和位置，从而实现对整个字符串的解码。
3. **含有嵌套的分子式求原子数量**：题目要求计算含有嵌套的分子式中各原子的数量，时间复杂度为O(n)。在解题过程中，递归函数用于解析分子式中的嵌套结构，统计各原子的数量，并借助全局变量协调不同层次递归之间的解析进度，最终准确求出分子式中各原子的数量。

## 四、总结

嵌套类问题的递归解题套路关键在于利用全局变量记录解析位置，通过递归函数逐层处理嵌套结构。在实战题目中，无论是表达式求值、字符串解码还是分子式求原子数量，都可运用此套路，按照从内到外的顺序，逐步解析嵌套内容，最终得到问题的解。掌握这一套路有助于高效解决各类嵌套问题，提高算法设计与实现的能力。