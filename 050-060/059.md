# 第59课：建图、链式前向星、拓扑排序

## 一、建图

- **定义**：根据给定的节点数量和边的信息，构建图的结构。
- **三种建图方式**：
  - **邻接矩阵**：用二维数组存储图，适合点的数量不多的图。对于无向图，矩阵是对称的；对于有向图，矩阵不一定对称。优点是实现简单，便于判断两个点之间是否存在边以及获取边的权重；缺点是空间复杂度较高，为O(n^2)，其中n是节点数量。
  - **邻接表**：最常用的建图方式。对于每个节点，用一个链表（或数组、向量等）存储与该节点相邻的节点。优点是空间复杂度相对较低，为O(n + m)，其中m是边的数量，适合稀疏图；缺点是实现相对复杂一些，且在判断两个点之间是否存在边时不如邻接矩阵直观。
  - **链式前向星**：在空间要求严苛的情况下使用，比赛必用，但在大厂笔试、面试中不常用。它通过数组存储边的信息，包括起点、终点、权重等，并通过一个数组存储每个节点的边的起始位置。优点是空间利用率高，缺点是实现较为复杂，且在处理某些问题时不如邻接表直观。
- **适用场景**：根据具体问题的需求和限制选择合适的建图方式。如果节点数量较少且对空间要求不高，可选用邻接矩阵；如果图较为稀疏，优先考虑邻接表；在对空间要求极为严格且需要快速构建图的场景下，可采用链式前向星。

## 二、链式前向星

- **基本概念**：是一种存储图的边信息的数据结构，通常用于处理边较多的图。它通过数组存储边的信息，包括起点、终点、权重等，并通过一个数组存储每个节点的边的起始位置。
- **存储结构**：
  - **边表**：用一个数组存储边的信息，每条边包含起点、终点、权重等属性。
  - **头指针数组**：用一个数组存储每个节点的边的起始位置，即该节点的第一条边在边表中的索引。
- **优点**：
  - **空间效率高**：相比邻接矩阵，在处理稀疏图时占用空间更少。
  - **便于动态添加边**：可以在不重新构建整个图结构的情况下，方便地添加新的边。
- **缺点**：
  - **实现复杂度较高**：需要正确处理头指针数组和边表之间的关系，实现起来相对复杂。
  - **查询边的效率较低**：与邻接矩阵相比，在判断两个点之间是否存在边以及获取边的权重时，需要遍历边表，效率较低。
- **应用场景**：适用于边较多且对空间要求较高的图问题，如在竞赛中处理大规模图数据时，链式前向星可以有效节省空间并提高性能。

## 三、拓扑排序

- **定义**：对一个有向无环图（DAG）的所有顶点进行线性排序，使得对于图中的每一个边(u, v)，u都出现在v的前面。
- **实现步骤**：
  1. **计算入度**：遍历图中的所有边，统计每个节点的入度（即指向该节点的边的数量）。
  2. **入度为0的节点入队**：将所有入度为0的节点加入队列。
  3. **循环处理**：当队列不为空时，执行以下操作：
     - 从队列中取出一个节点，将其加入拓扑排序结果中。
     - 遍历该节点的所有邻接点，将邻接点的入度减1（表示删除边的影响）。
     - 如果某个邻接点的入度变为0，则将其加入队列。
  4. **判断是否有环**：如果最终拓扑排序结果中的节点数量等于图中的节点总数，则说明图中没有环，拓扑排序成功；否则，图中存在环，拓扑排序失败。
- **应用场景**：
  - **任务调度**：在项目管理、生产调度等领域，根据任务之间的依赖关系，确定任务的执行顺序。
  - **课程安排**：如题目2中的课程安排问题，根据课程之间的先修关系，确定课程的学习顺序。
  - **数据序列化**：在某些数据结构的序列化和反序列化过程中，需要根据对象之间的依赖关系进行拓扑排序，以确保正确地恢复对象的结构。
- **变种问题**：
  - **字典序最小的拓扑排序**：要求返回所有正确的拓扑排序中字典序最小的结果。在实现时，需要使用小根堆来优先处理入度为0且字典序最小的节点。
  - **火星词典问题**：通过构建图并进行拓扑排序，根据给定的单词列表推断出火星语言的字母顺序。该问题需要根据单词之间的字典序关系构建图的边，然后进行拓扑排序，最后根据排序结果确定字母顺序。

## 四、相关题目

- **题目1**：三种方式的建图和遍历。通过实际操作，熟悉邻接矩阵、邻接表和链式前向星三种建图方式，并掌握它们的遍历方法。
- **题目2**：拓扑排序模板。使用邻接表建图（动态方式）和链式前向星建图（静态方式）实现拓扑排序，解决课程安排问题。测试链接为[LeetCode课程安排问题](https://leetcode.cn/problems/course-schedule-ii)和[牛客网课程安排问题](https://www.nowcoder.com/practice/88f7e156ca7d43a1a535f619cd3f495c)。
- **题目3**：字典序最小的拓扑排序。要求使用链式前向星建图，并利用小根堆实现字典序最小的拓扑排序。测试链接为[洛谷字典序最小的拓扑排序问题](https://www.luogu.com.cn/problem/U107394)。
- **题目4**：火星词典。通过构建图并进行拓扑排序，根据给定的单词列表推断出火星语言的字母顺序。测试链接为[LeetCode火星词典问题](https://leetcode.cn/problems/alien-dictionary)。
- **题目5**：戳印序列。虽然该问题主要涉及字符串匹配和贪心算法，但在某些情况下也可以通过构建图并进行拓扑排序来解决。测试链接为[LeetCode戳印序列问题](https://leetcode.cn/problems/stamping-the-sequence)。